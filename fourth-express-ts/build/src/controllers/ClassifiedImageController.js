"use strict";
const ClassifiedImageBusiness = require("./../app/business/ClassifiedImageBusiness");
class ClassifiedImageController {
    create(req, res, next) {
        console.log('classify controller create'); // req.body);
        try {
            const classifiedImageBusiness = new ClassifiedImageBusiness();
            classifiedImageBusiness.create(req, (error, result) => {
                if (error) {
                    console.log('error in image db add');
                    res.send({ 'error': 'error' });
                }
                else {
                    console.log('save success');
                    // store the saved doc id in the response for the next middleware to use
                    res.locals._id = result._id;
                    next();
                }
            });
        }
        catch (e) {
            console.log(e);
            res.send({ 'error': 'error in your request' });
        }
    }
    classify(req, res) {
        console.log('controller classify');
        try {
            const classifiedImageBusiness = new ClassifiedImageBusiness();
            classifiedImageBusiness.classify(res, (error, result) => {
                if (error) {
                    console.log('error in image classify');
                    res.send({ 'error': 'error' });
                }
                else {
                    console.log('classify success!!');
                    res.send({ 'success': 'success' });
                }
            });
        }
        catch (e) {
            console.log(e);
            res.send({ 'error': 'error in your request' });
        }
    }
    update(req, res) {
        try {
            const classifiedImage = req.body;
            const _id = req.params._id;
            const classifiedImageBusiness = new ClassifiedImageBusiness();
            classifiedImageBusiness.update(_id, classifiedImage, (error, result) => {
                if (error) {
                    res.send({ 'error': 'error' });
                }
                else {
                    res.send({ 'success': 'success' });
                }
            });
        }
        catch (e) {
            console.log(e);
            res.send({ 'error': 'error in your request' });
        }
    }
    delete(req, res) {
        try {
            const _id = req.params._id;
            const classifiedImageBusiness = new ClassifiedImageBusiness();
            classifiedImageBusiness.delete(_id, (error, result) => {
                if (error) {
                    res.send({ 'error': 'error' });
                }
                else {
                    res.send({ 'success': 'success' });
                }
            });
        }
        catch (e) {
            console.log(e);
            res.send({ 'error': 'error in your request' });
        }
    }
    retrieve(req, res) {
        try {
            const classifiedImageBusiness = new ClassifiedImageBusiness();
            classifiedImageBusiness.retrieve((error, result) => {
                if (error) {
                    res.send({ 'error': 'error' });
                }
                else {
                    res.send(result);
                }
            });
        }
        catch (e) {
            console.log(e);
            res.send({ 'error': 'error in your request' });
        }
    }
    findById(req, res) {
        try {
            const _id = req.params._id;
            const classifiedImageBusiness = new ClassifiedImageBusiness();
            classifiedImageBusiness.findById(_id, (error, result) => {
                if (error) {
                    res.send({ 'error': 'error' });
                }
                else {
                    res.send(result);
                }
            });
        }
        catch (e) {
            console.log(e);
            res.send({ 'error': 'error in your request' });
        }
    }
    findImageFileById(req, res) {
        try {
            const _id = req.params._id;
            console.log('looking for id: ', _id);
            const classifiedImageBusiness = new ClassifiedImageBusiness();
            classifiedImageBusiness.findById(_id, (error, result) => {
                if (error) {
                    res.send({ 'error': 'error' });
                }
                else {
                    res.set('Content-Type', result.img.content_type);
                    res.send(result.img.data);
                }
            });
        }
        catch (e) {
            console.log(e);
            res.send({ 'error': 'error in your request' });
        }
    }
}
module.exports = ClassifiedImageController;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNyYy9jb250cm9sbGVycy9DbGFzc2lmaWVkSW1hZ2VDb250cm9sbGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFDQSxxRkFBc0Y7QUFNdEY7SUFFRSxNQUFNLENBQUMsR0FBK0MsRUFBRSxHQUFxQixFQUFFLElBQVM7UUFDdEYsT0FBTyxDQUFDLEdBQUcsQ0FBQyw0QkFBNEIsQ0FBQyxDQUFDLENBQUMsYUFBYTtRQUN4RCxJQUFJLENBQUM7WUFFSCxNQUFNLHVCQUF1QixHQUFHLElBQUksdUJBQXVCLEVBQUUsQ0FBQztZQUU5RCx1QkFBdUIsQ0FBQyxNQUFNLENBQUUsR0FBRyxFQUFFLENBQUMsS0FBVSxFQUFFLE1BQVc7Z0JBQzNELEVBQUUsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUM7b0JBQ1YsT0FBTyxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO29CQUNyQyxHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUMsT0FBTyxFQUFFLE9BQU8sRUFBQyxDQUFDLENBQUM7Z0JBQy9CLENBQUM7Z0JBQUMsSUFBSSxDQUFDLENBQUM7b0JBQ04sT0FBTyxDQUFDLEdBQUcsQ0FBQyxjQUFjLENBQUMsQ0FBQztvQkFDNUIsd0VBQXdFO29CQUN4RSxHQUFHLENBQUMsTUFBTSxDQUFDLEdBQUcsR0FBRyxNQUFNLENBQUMsR0FBRyxDQUFDO29CQUM1QixJQUFJLEVBQUUsQ0FBQztnQkFDVCxDQUFDO1lBQ0gsQ0FBQyxDQUFDLENBQUM7UUFFTCxDQUFDO1FBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUUsQ0FBQztZQUNaLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDZixHQUFHLENBQUMsSUFBSSxDQUFDLEVBQUMsT0FBTyxFQUFFLHVCQUF1QixFQUFDLENBQUMsQ0FBQztRQUUvQyxDQUFDO0lBQ0gsQ0FBQztJQUNELFFBQVEsQ0FBQyxHQUErQyxFQUFFLEdBQXFCO1FBQzdFLE9BQU8sQ0FBQyxHQUFHLENB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Q1osT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUNmLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBQyxPQUFPLEVBQUUsdUJBQXVCLEVBQUMsQ0FBQyxDQUFDO1FBQy9DLENBQUM7SUFDSCxDQUFDO0NBRUY7QUFDRCxpQkFBUyx5QkFBeUIsQ0FBQyIsImZpbGUiOiJzcmMvY29udHJvbGxlcnMvQ2xhc3NpZmllZEltYWdlQ29udHJvbGxlci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpO1xuaW1wb3J0IENsYXNzaWZpZWRJbWFnZUJ1c2luZXNzID0gcmVxdWlyZSgnLi8uLi9hcHAvYnVzaW5lc3MvQ2xhc3NpZmllZEltYWdlQnVzaW5lc3MnKTtcbmltcG9ydCBJQmFzZUNvbnRyb2xsZXIgPSByZXF1aXJlKCcuL2ludGVyZmFjZXMvYmFzZS9CYXNlQ29udHJvbGxlcicpO1xuaW1wb3J0IElDbGFzc2lmaWVkSW1hZ2VNb2RlbCA9IHJlcXVpcmUoJy4vLi4vYXBwL21vZGVsL2ludGVyZmFjZXMvQ2xhc3NpZmllZEltYWdlTW9kZWwnKTtcbmltcG9ydCBJTXVsdGVyRmlsZU1vZGVsID0gcmVxdWlyZSgnLi8uLi9hcHAvbW9kZWwvaW50ZXJmYWNlcy9NdWx0ZXJGaWxlTW9kZWwnKTtcblxuXG5jbGFzcyBDbGFzc2lmaWVkSW1hZ2VDb250cm9sbGVyIGltcGxlbWVudHMgSUJhc2VDb250cm9sbGVyIDxDbGFzc2lmaWVkSW1hZ2VCdXNpbmVzcz4ge1xuXG4gIGNyZWF0ZShyZXE6IGV4cHJlc3MuUmVxdWVzdCAmIHtmaWxlOiBJTXVsdGVyRmlsZU1vZGVsfSwgcmVzOiBleHByZXNzLlJlc3BvbnNlLCBuZXh0OiBhbnkpOiB2b2lkIHtcbiAgICBjb25zb2xlLmxvZygnY2xhc3NpZnkgY29udHJvbGxlciBjcmVhdGUnKTsgLy8gcmVxLmJvZHkpO1xuICAgIHRyeSB7XG5cbiAgICAgIGNvbnN0IGNsYXNzaWZpZWRJbWFnZUJ1c2luZXNzID0gbmV3IENsYXNzaWZpZWRJbWFnZUJ1c2luZXNzKCk7XG5cbiAgICAgIGNsYXNzaWZpZWRJbWFnZUJ1c2luZXNzLmNyZWF0ZSggcmVxLCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ2Vycm9yIGluIGltYWdlIGRiIGFkZCcpO1xuICAgICAgICAgIHJlcy5zZW5kKHsnZXJyb3InOiAnZXJyb3InfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ3NhdmUgc3VjY2VzcycpO1xuICAgICAgICAgIC8vIHN0b3JlIHRoZSBzYXZlZCBkb2MgaWQgaW4gdGhlIHJlc3BvbnNlIGZvciB0aGUgbmV4dCBtaWRkbGV3YXJlIHRvIHVzZVxuICAgICAgICAgIHJlcy5sb2NhbHMuX2lkID0gcmVzdWx0Ll9pZDtcbiAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgfSBjYXRjaCAoZSkgIHtcbiAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgcmVzLnNlbmQoeydlcnJvcic6ICdlcnJvciBpbiB5b3VyIHJlcXVlc3QnfSk7XG5cbiAgICB9XG4gIH1cbiAgY2xhc3NpZnkocmVxOiBleHByZXNzLlJlcXVlc3QgJiB7ZmlsZTogSU11bHRlckZpbGVNb2RlbH0sIHJlczogZXhwcmVzcy5SZXNwb25zZSk6IHZvaWQge1xuICAgIGNvbnNvbGUubG9nKCdjb250cm9sbGVyIGNsYXNzaWZ5Jyk7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNsYXNzaWZpZWRJbWFnZUJ1c2luZXNzID0gbmV3IENsYXNzaWZpZWRJbWFnZUJ1c2luZXNzKCk7XG5cbiAgICAgIGNsYXNzaWZpZWRJbWFnZUJ1c2luZXNzLmNsYXNzaWZ5KCByZXMsIChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygnZXJyb3IgaW4gaW1hZ2UgY2xhc3NpZnknKTtcbiAgICAgICAgICByZXMuc2VuZCh7J2Vycm9yJzogJ2Vycm9yJ30pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCdjbGFzc2lmeSBzdWNjZXNzISEnKTtcbiAgICAgICAgICByZXMuc2VuZCh7J3N1Y2Nlc3MnOiAnc3VjY2Vzcyd9KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZSkgIHtcbiAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgcmVzLnNlbmQoeydlcnJvcic6ICdlcnJvciBpbiB5b3VyIHJlcXVlc3QnfSk7XG4gICAgfVxuXG4gIH1cblxuICB1cGRhdGUocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSk6IHZvaWQge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjbGFzc2lmaWVkSW1hZ2U6IElDbGFzc2lmaWVkSW1hZ2VNb2RlbCA9IDxJQ2xhc3NpZmllZEltYWdlTW9kZWw+cmVxLmJvZHk7XG4gICAgICBjb25zdCBfaWQ6IHN0cmluZyA9IHJlcS5wYXJhbXMuX2lkO1xuICAgICAgY29uc3QgY2xhc3NpZmllZEltYWdlQnVzaW5lc3MgPSBuZXcgQ2xhc3NpZmllZEltYWdlQnVzaW5lc3MoKTtcbiAgICAgIGNsYXNzaWZpZWRJbWFnZUJ1c2luZXNzLnVwZGF0ZShfaWQsIGNsYXNzaWZpZWRJbWFnZSwgKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIHJlcy5zZW5kKHsnZXJyb3InOiAnZXJyb3InfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzLnNlbmQoeydzdWNjZXNzJzogJ3N1Y2Nlc3MnfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGUpICB7XG4gICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgIHJlcy5zZW5kKHsnZXJyb3InOiAnZXJyb3IgaW4geW91ciByZXF1ZXN0J30pO1xuICAgIH1cbiAgfVxuICBkZWxldGUocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSk6IHZvaWQge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBfaWQ6IHN0cmluZyA9IHJlcS5wYXJhbXMuX2lkO1xuICAgICAgY29uc3QgY2xhc3NpZmllZEltYWdlQnVzaW5lc3MgPSBuZXcgQ2xhc3NpZmllZEltYWdlQnVzaW5lc3MoKTtcbiAgICAgIGNsYXNzaWZpZWRJbWFnZUJ1c2luZXNzLmRlbGV0ZShfaWQsIChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICByZXMuc2VuZCh7J2Vycm9yJzogJ2Vycm9yJ30pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlcy5zZW5kKHsnc3VjY2Vzcyc6ICdzdWNjZXNzJ30pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9IGNhdGNoIChlKSAge1xuICAgICAgY29uc29sZS5sb2coZSk7XG4gICAgICByZXMuc2VuZCh7J2Vycm9yJzogJ2Vycm9yIGluIHlvdXIgcmVxdWVzdCd9KTtcbiAgICB9XG4gIH1cbiAgcmV0cmlldmUocmVxOiBleHByZXNzLlJlcXVlc3QsIHJlczogZXhwcmVzcy5SZXNwb25zZSk6IHZvaWQge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjbGFzc2lmaWVkSW1hZ2VCdXNpbmVzcyA9IG5ldyBDbGFzc2lmaWVkSW1hZ2VCdXNpbmVzcygpO1xuICAgICAgY2xhc3NpZmllZEltYWdlQnVzaW5lc3MucmV0cmlldmUoKGVycm9yOiBhbnksIHJlc3VsdDogYW55KSA9PiB7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgIHJlcy5zZW5kKHsnZXJyb3InOiAnZXJyb3InfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzLnNlbmQocmVzdWx0KTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSBjYXRjaCAoZSkgIHtcbiAgICAgIGNvbnNvbGUubG9nKGUpO1xuICAgICAgcmVzLnNlbmQoeydlcnJvcic6ICdlcnJvciBpbiB5b3VyIHJlcXVlc3QnfSk7XG4gICAgfVxuICB9XG4gIGZpbmRCeUlkKHJlcTogZXhwcmVzcy5SZXF1ZXN0LCByZXM6IGV4cHJlc3MuUmVzcG9uc2UpOiB2b2lkIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgX2lkOiBzdHJpbmcgPSByZXEucGFyYW1zLl9pZDtcbiAgICAgIGNvbnN0IGNsYXNzaWZpZWRJbWFnZUJ1c2luZXNzID0gbmV3IENsYXNzaWZpZWRJbWFnZUJ1c2luZXNzKCk7XG4gICAgICBjbGFzc2lmaWVkSW1hZ2VCdXNpbmVzcy5maW5kQnlJZChfaWQsIChlcnJvcjogYW55LCByZXN1bHQ6IGFueSkgPT4ge1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICByZXMuc2VuZCh7J2Vycm9yJzogJ2Vycm9yJ30pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJlcy5zZW5kKHJlc3VsdCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGUpICB7XG4gICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgIHJlcy5zZW5kKHsnZXJyb3InOiAnZXJyb3IgaW4geW91ciByZXF1ZXN0J30pO1xuICAgIH1cbiAgfVxuICBmaW5kSW1hZ2VGaWxlQnlJZChyZXE6IGV4cHJlc3MuUmVxdWVzdCwgcmVzOiBleHByZXNzLlJlc3BvbnNlKTogdm9pZCB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IF9pZDogc3RyaW5nID0gcmVxLnBhcmFtcy5faWQ7XG4gICAgICBjb25zb2xlLmxvZygnbG9va2luZyBmb3IgaWQ6ICcsIF9pZCk7XG4gICAgICBjb25zdCBjbGFzc2lmaWVkSW1hZ2VCdXNpbmVzcyA9IG5ldyBDbGFzc2lmaWVkSW1hZ2VCdXNpbmVzcygpO1xuICAgICAgY2xhc3NpZmllZEltYWdlQnVzaW5lc3MuZmluZEJ5SWQoX2lkLCAoZXJyb3I6IGFueSwgcmVzdWx0OiBhbnkpID0+IHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgcmVzLnNlbmQoeydlcnJvcic6ICdlcnJvcid9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXMuc2V0KCAnQ29udGVudC1UeXBlJywgcmVzdWx0LmltZy5jb250ZW50X3R5cGUgKTtcbiAgICAgICAgICByZXMuc2VuZCggcmVzdWx0LmltZy5kYXRhICk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0gY2F0Y2ggKGUpICB7XG4gICAgICBjb25zb2xlLmxvZyhlKTtcbiAgICAgIHJlcy5zZW5kKHsnZXJyb3InOiAnZXJyb3IgaW4geW91ciByZXF1ZXN0J30pO1xuICAgIH1cbiAgfVxuXG59XG5leHBvcnQgPSBDbGFzc2lmaWVkSW1hZ2VDb250cm9sbGVyO1xuIl19
